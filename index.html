<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#075e54">
    <title>Carregando...</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1244/1244696.png">
</head>
<body>

    <div id="loadingScreen" class="screen active">
        <div class="splash-content">
            <img src="https://cdn-icons-png.flaticon.com/512/1244/1244696.png" alt="Logo" width="80">
            <p>Carregando...</p>
        </div>
    </div>

    <div id="loginScreen" class="screen">
        <div class="login-box">
            <h2 class="app-title">Zap</h2>
            <p>Identifique-se para entrar:</p>
            <input type="email" id="emailInput" placeholder="Seu e-mail">
            <input type="password" id="passInput" placeholder="Sua senha">
            <button onclick="fazerLogin()">Entrar</button>
            <p id="loginError" class="error-msg"></p>
        </div>
    </div>

    <div id="profileScreen" class="screen">
        <header>
            <h3>Criar/Editar Perfil</h3>
        </header>
        <div class="profile-container">
            <div class="profile-photo-wrapper" onclick="document.getElementById('profilePhotoInput').click()">
                <img id="profilePreview" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="Perfil">
                <div class="edit-overlay">ğŸ“· Alterar</div>
            </div>
            <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="previewImagemPerfil(this)">

            <label>Seu Nome:</label>
            <input type="text" id="profileName" placeholder="Ex: Pai" maxlength="20">

            <label>Frase de Status:</label>
            <input type="text" id="profileStatus" placeholder="Ex: DisponÃ­vel" maxlength="50">

            <button class="btn-save" onclick="salvarPerfil()">ğŸ’¾ Salvar Perfil</button>
        </div>
    </div>

    <div id="contactsScreen" class="screen">
        <header>
            <h3 class="app-title">Zap</h3>
            <div class="header-actions">
                <button class="btn-icon" onclick="editarMeuPerfil()">ğŸ‘¤</button>
                <button class="btn-sair" onclick="fazerLogout()">Sair</button>
            </div>
        </header>
        
        <div id="avisoNotificacao" class="barra-aviso" style="display:none">
            ğŸ”” Toque aqui para ativar notificaÃ§Ãµes
        </div>

        <div class="container-lista">
            <p class="aviso-topo">Contatos:</p>
            <div id="listaContatos">
                <div style="text-align:center; padding:20px; color:#666">Carregando contatos...</div>
            </div>
        </div>
    </div>

    <div id="chatScreen" class="screen">
        <header>
            <button class="btn-voltar" onclick="voltarParaContatos()">â¬…</button>
            <img id="chatHeaderAvatar" class="mini-avatar" src="">
            <div class="header-info">
                <h3 id="chatTitle">Nome</h3>
                <small id="chatStatus">...</small> 
            </div>
            <button class="btn-lixeira" onclick="limparConversaInteira()" title="Apagar tudo">ğŸ—‘ï¸</button>
        </header>

        <main id="messagesList"></main>

        <footer>
            <form id="msgForm" onsubmit="enviarMensagem(event)">
                <label for="fileInput" class="btn-anexo">ğŸ“</label>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">

                <label for="cameraInput" class="btn-camera">ğŸ“·</label>
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">

                <input type="text" id="msgInput" placeholder="Mensagem..." autocomplete="off" oninput="avisarDigitando()">
                
                <button type="button" id="btnMic" class="btn-mic">ğŸ¤</button>
                <button type="submit" id="btnEnviar">â¤</button>
            </form>
        </footer>
    </div>

    <div id="imagePreviewModal" class="modal-overlay">
        <div class="modal-content">
            <h3>Enviar esta foto?</h3>
            <div class="preview-area">
                <img id="imgPreviewToSend" src="" alt="Preview">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="cancelarEnvioFoto()">âŒ NÃ£o</button>
                <button class="btn-confirm" onclick="confirmarEnvioFoto()">âœ… Enviar</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('./firebase-messaging-sw.js'));
        }
    </script>
</body>
</html>
